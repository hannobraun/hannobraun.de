(function(){function b(){this.running=!1,this.groups={}}var a=require("spell/common/util/spellUtils");b.PASSED_TIME=0,b.ARGUMENTS="arguments",b.COMPONENT_QUERY="component query",b.COMPONENT_QUERY_WITH_DEFAULTS="component query with defaults",b.prototype.isRunning=function(a){this.running=a;return this},b.prototype.withDuration=function(a){this.duration=a;return this},b.prototype.withSleepTime=function(a){this.sleepTime=a;return this},b.prototype.withGroup=function(a){this._currentGroup=[],this.groups[a]=this._currentGroup;return this},b.prototype.withCallTo=function(a){this._currentCall={functionToCall:a,arguments:[],componentUpdates:[]},this._currentGroup.push(this._currentCall);return this},b.prototype.withArguments=function(a){this._currentCall.arguments.push({type:b.ARGUMENTS,arguments:a});return this},b.prototype.withComponents=function(a){this._currentArgument={type:b.COMPONENT_QUERY,query:a},this._currentCall.arguments.push(this._currentArgument),this._currentQuery=a;return this},b.prototype.withDefaultFor=function(a,c){if(this._currentArgument.type==b.COMPONENT_QUERY_WITH_DEFAULTS)this._currentArgument.defaults[c]=a;else{var d={};d[c]=a,this._currentArgument={type:b.COMPONENT_QUERY_WITH_DEFAULTS,query:this._currentQuery,defaults:d},this._currentCall.arguments.pop(),this._currentCall.arguments.push(this._currentArgument)}return this},b.prototype.withEntityUpdates=function(a){this._currentArgument.entityUpdates=!0;return this},b.prototype.updatingComponents=function(a){this._currentCall.componentUpdates.push({query:this._currentQuery,components:a});return this},b.prototype.updatingAllComponents=function(){this._currentCall.componentUpdates.push({query:this._currentQuery,components:this._currentQuery});return this},b.prototype.updatingAllComponentsExcept=function(a){var b=this._currentQuery.filter(function(b){return!a.some(function(a){return a==b})});this._currentCall.componentUpdates.push({query:this._currentQuery,components:b});return this},b.prototype.withResult=function(a){this._currentCall.result=a;return this},a.makePropertiesNonEnumerable(b.prototype),typeof window=="undefined"?module.exports=b:register("spell/common/core/MainLoop",b)})()