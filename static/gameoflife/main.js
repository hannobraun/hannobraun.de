function resetSimulation(){simulationRunning=!1,reset=!0,document.getElementById("startButton").disabled=!1,document.getElementById("resetButton").disabled=!0}function start(){simulationRunning=!0,document.getElementById("startButton").disabled=!0,document.getElementById("resetButton").disabled=!1}(function(){function G(){reset&&(b.entities._entities={},reset=!1,r=g("cursor").withScale(o,o).build(),s=c().withComponent(l(-1,-1)).withComponent(r).withComponent(d("cursor",{})).create(),b.entities.create(s))}function F(){var a=0;b.entities._entities.forIn(function(b,c){a+=1,c.forIn(function(a,b){b===undefined&&console.log(a+" is undefined!")})})}function E(a,b){simulationRunning&&a.length.timesDo(function(c){a[c].lives===!1&&b[c].remove()})}function D(a){var b=[new e(-1,-1),new e(0,-1),new e(1,-1),new e(-1,0),new e(1,0),new e(-1,1),new e(0,1),new e(1,1)];return b.map(function(b){return a.plus(b)})}function C(a,b,c){if(simulationRunning){var d=new k(1);a.length.timesDo(function(c){var e=a[c],f=b[c],g=0;D(e).forEach(function(b){var c=a.inSameTileAs(b);if(c.length===0)d.inSameTileAs(b).length===0&&d.push(b);else if(c.length===1)g+=1;else throw"Invalid number of cells at positions (position: ("+b.x+", "+b.y+"); number of cells: "+c.length+")"});if(g<2||g>3)f.lives=!1});for(var e=0;e<d.length;e++){var f=d[e],g=0;D(f).forEach(function(b){a.inSameTileAs(b).length>0&&(g+=1)}),g===3&&c.create(q(f))}}return[b]}function B(a,b,c){if(!simulationRunning&&w.click){var d=new e(Math.floor(w.x/n),Math.floor(w.y/n));if(!d.equals(A)){var f=a.inSameTileAs(d);if(f.length===0)c.create(q(d));else{var g=c[f[0]];g.remove()}A=d}}}function z(a,b){var c=new e(Math.floor(w.x/n),Math.floor(w.y/n));return[[c]]}function x(a){w.x=a.clientX,w.y=a.clientY,a.type==="mousedown"&&(w.click=!0),a.type==="mouseup"&&(w.click=!1)}function q(a){var b=g("cell").withScale(o,o).withZIndex(1).build(),d=c().withComponent(l(a)).withComponent(b).withComponent(p()).create();return d}function p(){return d("cell",{lives:!0})}var a=require("spell/common/core/SpellFramework"),b=new a,c=require("spell/common/core/buildEntity"),d=require("spell/common/core/component"),e=require("spell/common/math/Vector"),f=require("spell/common/base/baseComponents"),g=require("spell/common/rendering/renderingComponents").buildAppearance,h=require("spell/common/rendering/defineImages"),i=require("spell/common/rendering/Renderer"),j=require("spell/browser/rendering/SceneView"),k=require("gameoflife/TiledPositionStructure"),l=f.position,m=f.rotation,n=16,o=1/32,r=g("cursor").withScale(o,o).build(),s=c().withComponent(l(-1,-1)).withComponent(r).withComponent(d("cursor",{})).create();b.entities.create(s),b.entities.setDataStructureFor("position",function(){return new k(1)});var t=new j("main");t.viewSize={x:t.width/n,y:t.height/n};const u=800,v=600;var w={x:u/2,y:v/2,click:!1};t.canvas.onmousedown=t.canvas.onmouseup=t.canvas.onmousemove=x,t.canvas.style.cursor="none",b.beforeAssetsAreLoadedDo(function(a){var b=h(function(a){a("cell.png").takeImage(),a("cursor.png").takeImage()});a(b)});var y=null;b.afterAssetsAreLoadedDo(function(a){var b=new i(a);y=b.render.bind(b).curry(t)}),b.defineMainLoop(function(a,b,c){a.runEvery(.02).seconds(),a.everyTick().execute(function(a){c(z).processComponents("position","cursor").updating("position"),c(B).processComponents("position","cell").andUpdateEntities(),c(y).processComponents("position","rotation","appearance").withDefault(0).forComponent("rotation")}),a.every(15).ticks().execute(function(a){c(C).processComponents("position","cell").updating("cell").andUpdateEntities(),c(E).processComponents("cell").andUpdateEntities(),b(G)})});var A=new e(-1,-1);simulationRunning=!1,reset=!1,b.run()})()
