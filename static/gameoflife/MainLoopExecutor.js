(function(){function b(a,b,c){this._entities=a,this._mainLoop=b,this._entityUpdaterFactory=c,this._variables={0:b.sleepTime},this._currentTick=0}var a=require("spell/common/core/MainLoop");b.prototype.execute=function(){var a=this;this._mainLoop.running=!0,this._intervalId=setInterval(function(){a._loop()},a._mainLoop.sleepTime*1e3)},b.prototype._loop=function(){var b=this;for(var c in this._mainLoop.groups){if(this._currentTick%c!=0)continue;var d=this._mainLoop.groups[c];d.forEach(function(d){var e=[],f=[];d.arguments.forEach(function(d){if(d.type==a.ARGUMENTS){var g=d.arguments.map(function(a){return a==0?b._variables[a]*c:b._variables[a]});e=e.concat(g)}else if(d.type==a.COMPONENT_QUERY||d.type==a.COMPONENT_QUERY_WITH_DEFAULTS){if(d.type==a.COMPONENT_QUERY){var h=b._entities.returnComponents(d.query);e=e.concat(h)}if(d.type==a.COMPONENT_QUERY_WITH_DEFAULTS){var h=b._entities.returnComponentsWithDefaults(d.query,d.defaults);e=e.concat(h)}if(d.entityUpdates==!0){var i=b._entities.returnEntitiesWith(d.query||d.requiredQuery),j=b._entityUpdaterFactory(i);e.push(j),f.push(j)}}});var g=d.functionToCall.apply(undefined,e);b._variables[d.result]=g;var h=0;d.componentUpdates.forEach(function(a){var c=b._entities.returnComponents(a.query),d=c.map(function(b,c){var d=a.components.some(function(b){return b==a.query[c]});return d?g[h++]:b});b._entities.updateComponents(a.query,d)}),f.forEach(function(a){a.execute()})})}this._currentTick+=1,this._mainLoop.duration==this._currentTick&&(this._mainLoop.running=!1,clearTimeout(this._intervalId))},typeof window=="undefined"?module.exports=b:register("spell/common/core/MainLoopExecutor",b)})()